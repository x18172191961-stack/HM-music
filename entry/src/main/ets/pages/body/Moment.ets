
import { momentList, songsList } from "../type/data"
import { GlobalMusic } from "../type/GlobalMusic"
import { momentListType } from "../type/momentListType"
import { SongItemType } from "../type/SongItemType"

@ComponentV2
export  struct Moment {
  // æ­Œæ›²æ•°æ®
  @Local
  songs: SongItemType[] = songsList
  @Local
  momentList:momentListType[]=momentList
  // @Local
  // playState: GlobalMusic = AppStorageV2.connect(GlobalMusic, "GlobalMusic", () => new GlobalMusic())!

  // å½“å‰æ’­æ”¾çš„æ­Œæ›²
  build() {
    Scroll() {
      Column() {
        // æ ‡é¢˜
        Text('äº’åŠ¨å¹¿åœº')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor(Color.White)
          .margin({ top: 20, bottom: 20, left: 20 })
          .alignSelf(ItemAlign.Start)

        // åŠ¨æ€åˆ—è¡¨
        List() {
          ForEach(this.momentList, (item: momentListType) => {
            ListItem() {
              Column() {
                // ç”¨æˆ·ä¿¡æ¯å’Œå†…å®¹åŒºåŸŸ
                Row() {
                  // ç”¨æˆ·å¤´åƒ
                  Image(item.avatar)
                    .width(48)
                    .height(48)
                    .borderRadius(24)
                    .margin({ right: 12 })
                    .objectFit(ImageFit.Cover)

                  // ç”¨æˆ·ä¿¡æ¯å’Œå†…å®¹
                  Column() {
                    // ç”¨æˆ·å
                    Text(item.author)
                      .fontSize(16)
                      .fontWeight(FontWeight.Medium)
                      .fontColor(Color.White)
                      .alignSelf(ItemAlign.Start)
                      .margin({ bottom: 8 })

                    // å†…å®¹
                    Text(item.content)
                      .width("80%")
                      .maxLines(1)
                      .ellipsisMode(EllipsisMode.END)
                      .textOverflow({ overflow: TextOverflow.Ellipsis })
                      .fontSize(16)
                      .fontColor(Color.White)
                      .alignSelf(ItemAlign.Start)
                      .margin({ bottom: 12 })
                      .lineHeight(24)

                    // æ­Œæ›²ä¿¡æ¯å¡ç‰‡
                    Row() {
                      Image(item.song.img)
                        .width(48)
                        .height(48)
                        .borderRadius(4)
                        .objectFit(ImageFit.Cover)

                      Column() {
                        Text(item.song.name)
                          .fontSize(14)
                          .fontColor(Color.White)
                          .fontWeight(FontWeight.Medium)
                          .alignSelf(ItemAlign.Start)
                          .lineHeight(20)

                        Text(item.song.author)
                          .fontSize(12)
                          .fontColor(Color.Gray)
                          .alignSelf(ItemAlign.Start)
                          .lineHeight(18)
                      }




                      // æ’­æ”¾æŒ‰é’®æ–‡æœ¬
                      // Image(item.song.url===this.playState.url&&
                      // this.playState.isPlay?$r('app.media.ic_paused'):$r('app.media.ic_play'))
                      //   .width(20) .margin({ left: 'auto' })
                      //   .onClick(()=>{
                      //     if (item.song.url===this.playState.url) {
                      //       avPlayerManage.stopOrContinueSong()
                      //     }else {
                      //       avPlayerManage.playResources(item.song)
                      //     }
                      //
                      //   })
                    } .width("65%")
                    .justifyContent(FlexAlign.SpaceBetween)


                    .backgroundColor('#2A2A2A')
                    .borderRadius(8)
                    .padding(8)
                    .margin({ bottom: 12 })
                  }

                  .alignItems(HorizontalAlign.Start)
                }
                .justifyContent(FlexAlign.SpaceBetween)
                .alignItems(VerticalAlign.Top)

                // æ“ä½œæŒ‰é’®åŒºåŸŸ
                Row() {
                  // åˆ†äº«æŒ‰é’®
                  Row() {
                    Text('â†— åˆ†äº«')
                      .fontSize(14)
                      .fontColor(Color.White)
                  }
                  .margin({ right: 24 })

                  // è¯„è®ºæŒ‰é’®
                  Row() {
                    Text('ğŸ’¬ ' + item.comment.toString())
                      .fontSize(14)
                      .fontColor(Color.White)
                  }
                  .margin({ right: 24 })

                  // ç‚¹èµæŒ‰é’®
                  Row() {
                    Text('â¤ï¸ ' + item.like.toString())
                      .fontSize(14)
                      .fontColor(Color.White)
                  }
                }
                .margin({left:10})
                .alignSelf(ItemAlign.Start)
              }

              .width("100%")

            }.margin({ bottom: 5, top: 5 })
          }, (item: momentListType) => item.author)
        }
        .edgeEffect(EdgeEffect.None)
        .scrollBar(BarState.Off)
        .nestedScroll({
          scrollForward: NestedScrollMode.PARENT_FIRST, //å‘å‰ ä¸æ˜¯å¯æ»šåŠ¨ç»„ä»¶ä¼˜å…ˆ
          scrollBackward: NestedScrollMode.SELF_FIRST // å‘å è‡ªèº«ä¼˜å…ˆ
        })
        .divider({ strokeWidth: 1, color: "#ff343434" })
        .width('100%')
        .height('100%')
        .padding({ top: 10, left: 10, right: 10 })
        .scrollBar(BarState.Off)
      }

    }.scrollBar(BarState.Off)
    .width('100%')
    .height('100%')

    .expandSafeArea()
  }
}